---
title: RustでWebAssemblyインタプリタ作った話
date: "2019-12-02T10:21:22.931Z"
update: "2019-12-02T10:21:22.931Z"
tags: ["webassembly"]
name: wasm-rs
lang: ja
otherLang: []
---

## はじめに
WebAssemblyについてです。

## リポジトリ
* Rustのcrateになっている
* ソースもコミットログもドキュメントもひどいけど気にしない

https://github.com/kgtkr/wasm-rs

## WebAssemblyについて
* Webで動くバイナリフォーマットの言語
* 略称wasm
* スタック領域は静的に型付けされている

wasmの色々な説明

## wasmはどう実行される
1. バイナリをパース
2. 検証
3. 実行

検証はしてないよ。小数命令実装できてないよ
ついでにバイナリエンコーダーも作った

## AST定義
やるだけ
色々考えてフラットじゃなくて再帰に

## バイナリのパース
仕様書読めばわかる
leだよ。可変長だよ。nomさいこー
propテスト最高と思ったけど最木構造ア

## 検証
サボった！ｗ()
そのうち

## 実行
スタックこういうふうに。再帰的構造だよ
ラベルとはー
制御命令が…
そのレイヤーで処理できないやつはこうやって返り値で…
循環参照の初期化つらみ
あとはやるだけ
RefCell地獄。Weakってのがあってだな


## バグった、公式にテストケースが
wastとかいうやつ。jsonに変換してえいえい
最高

## そういえば自作言語作ったな
wasmにコンパイルできる、つまり

## Rustってwasmにコンパイルできるよね？
つまりつまり
遅すぎ！ｗ

## これからやること
未実装命令
wast対応しっかり
panicやめたい
検証実装
RefCellなんとかしたい
読みにくくない範囲で高速化
proposal実装したいな
